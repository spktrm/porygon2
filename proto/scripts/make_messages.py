import json

with open("data/data/data.json") as f:
    DATA = json.load(f)


def toid(string: str) -> str:
    return "".join(c for c in string if c.isalnum()).lower()


def generate_enum(title: str, data: dict[str, int], dtype: str):
    data = [f"\t{dtype} {toid(key)} = {value+1};" for key, value in data.items()]
    return f"message {title.capitalize()}Message {{\n" + "\n".join(data) + "\n}"


DTYPE_MAPPING = {
    "pseudoWeather": "bool",
    "volatileStatus": "bool",
    "weathers": "bool",
    "terrain": "bool",
    "sideConditions": "int32",
    "hyphenArgs": "bool",
    "boosts": "int32",
}


def main():
    message_data = """syntax = "proto3";

package messages;

// This code is autogenerated by this script 
// proto/scripts/make_messages.py

"""

    for key, value in DATA.items():
        if key in DTYPE_MAPPING:
            message_data += generate_enum(key, value, DTYPE_MAPPING[key])
            message_data += "\n\n"

    with open("proto/messages.proto", "w") as f:
        f.write(message_data)


if __name__ == "__main__":
    main()
