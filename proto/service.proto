syntax = "proto3";

package servicev2;

message ClientRequest {
  oneof message_type {
    StepRequest step = 1;
    ResetRequest reset = 2;
  }
}

enum ActionEnum {
  ACTION_ENUM___UNSPECIFIED = 0;
  ACTION_ENUM__DEFAULT = 1;
  ACTION_ENUM__ALLY_1_MOVE_1 = 2;
  ACTION_ENUM__ALLY_1_MOVE_2 = 3;
  ACTION_ENUM__ALLY_1_MOVE_3 = 4;
  ACTION_ENUM__ALLY_1_MOVE_4 = 5;
  ACTION_ENUM__ALLY_1_MOVE_1_WILDCARD = 6;
  ACTION_ENUM__ALLY_1_MOVE_2_WILDCARD = 7;
  ACTION_ENUM__ALLY_1_MOVE_3_WILDCARD = 8;
  ACTION_ENUM__ALLY_1_MOVE_4_WILDCARD = 9;
  ACTION_ENUM__ALLY_2_MOVE_1 = 10;
  ACTION_ENUM__ALLY_2_MOVE_2 = 11;
  ACTION_ENUM__ALLY_2_MOVE_3 = 12;
  ACTION_ENUM__ALLY_2_MOVE_4 = 13;
  ACTION_ENUM__ALLY_2_MOVE_1_WILDCARD = 14;
  ACTION_ENUM__ALLY_2_MOVE_2_WILDCARD = 15;
  ACTION_ENUM__ALLY_2_MOVE_3_WILDCARD = 16;
  ACTION_ENUM__ALLY_2_MOVE_4_WILDCARD = 17;
  ACTION_ENUM__RESERVE_1 = 18;  
  ACTION_ENUM__RESERVE_2 = 19;
  ACTION_ENUM__RESERVE_3 = 20;
  ACTION_ENUM__RESERVE_4 = 21;
  ACTION_ENUM__RESERVE_5 = 22;
  ACTION_ENUM__RESERVE_6 = 23;
  ACTION_ENUM__ALLY_1 = 24;
  ACTION_ENUM__ALLY_2 = 25;
  ACTION_ENUM__ENEMY_1 = 26;
  ACTION_ENUM__ENEMY_2 = 27;
  ACTION_ENUM__TARGET_AUTO = 28;
  ACTION_ENUM__ALLY_1_PASS = 29;
  ACTION_ENUM__ALLY_2_PASS = 30;
}


message Action {
  ActionEnum src = 1;
  ActionEnum tgt = 2;
}

message StepRequest {
  string username = 1;
  Action action = 2;
  int32 rqid = 3;
  bool teampreview = 4;
}

message ResetRequest {
  string username = 1;
  repeated int32 species_indices = 2;
  repeated int32 packed_set_indices = 3;
  string smogon_format = 4;
  int32 current_ckpt = 5;
  int32 opponent_ckpt = 6;
}

message EnvironmentState {
  bytes info = 1;
  bytes action_mask = 2;
  bytes history_entity_public = 3;
  bytes history_entity_revealed = 4;
  bytes history_entity_edges = 5;
  bytes history_field = 6;
  int32 history_length = 7;
  bytes moveset = 8;
  bytes public_team = 9;
  bytes revealed_team = 10;
  bytes private_team = 11;
  bytes field = 12;
  int32 rqid = 13;
  int32 history_packed_length = 14;
}

message EnvironmentTrajectory {
  repeated EnvironmentState states = 1;
}

message EnvironmentResponse {
  string username = 1;
  EnvironmentState state = 2;
}

message ErrorResponse {
  string trace = 1;
}

message WorkerRequest {
  int32 task_id = 1;
  oneof request {
    StepRequest step_request = 2;
    ResetRequest reset_request = 3;
  }
}

message WorkerResponse {
  int32 task_id = 1;
  EnvironmentResponse environment_response = 2; 
  ErrorResponse error_response = 3; 
}
