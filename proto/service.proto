syntax = "proto3";

package servicev2;

message ClientRequest {
  oneof message_type {
    StepRequest step = 1;
    ResetRequest reset = 2;
  }
}

message Action {
  int32 action_type = 1;
  int32 move_slot = 2;
  int32 switch_slot = 3;
  int32 wildcard_slot = 4;
}

message StepRequest {
  string username = 1;
  Action action = 2;
  int32 rqid = 3;
}

message ResetRequest {
  string username = 1;
  repeated int32 species_indices = 2;
  repeated int32 packed_set_indices = 3;
  string smogon_format = 4;
  int32 current_ckpt = 5;
  int32 opponent_ckpt = 6;
}

message EnvironmentState {
  bytes info = 1;
  bytes action_mask = 2;
  bytes history_entity_public = 3;
  bytes history_entity_revealed = 4;
  bytes history_entity_edges = 5;
  bytes history_field = 6;
  int32 history_length = 7;
  bytes moveset = 8;
  bytes public_team = 9;
  bytes revealed_team = 10;
  bytes private_team = 11;
  bytes field = 12;
  int32 rqid = 13;
}

message EnvironmentTrajectory {
  repeated EnvironmentState states = 1;
}

message EnvironmentResponse {
  string username = 1;
  EnvironmentState state = 2;
}

message ErrorResponse {
  string trace = 1;
}

message WorkerRequest {
  int32 task_id = 1;
  oneof request {
    StepRequest step_request = 2;
    ResetRequest reset_request = 3;
  }
}

message WorkerResponse {
  int32 task_id = 1;
  EnvironmentResponse environment_response = 2; 
  ErrorResponse error_response = 3; 
  optional ResetRequest opponent_reset_request = 4;
}
