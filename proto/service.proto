syntax = "proto3";

package servicev2;

message ClientRequest {
  oneof message_type {
    StepRequest step = 1;
    ResetRequest reset = 2;
  }
}

enum ActionEnum {
  ACTION_ENUM___UNSPECIFIED = 0;
  ACTION_ENUM__MOVE_1_TARGET_NA = 1;
  ACTION_ENUM__MOVE_1_TARGET_1 = 2;
  ACTION_ENUM__MOVE_1_TARGET_2 = 3;
  ACTION_ENUM__MOVE_1_TARGET_3 = 4;
  ACTION_ENUM__MOVE_1_TARGET_4 = 5;
  ACTION_ENUM__MOVE_2_TARGET_NA = 6;
  ACTION_ENUM__MOVE_2_TARGET_1 = 7;
  ACTION_ENUM__MOVE_2_TARGET_2 = 8;
  ACTION_ENUM__MOVE_2_TARGET_3 = 9;
  ACTION_ENUM__MOVE_2_TARGET_4 = 10;
  ACTION_ENUM__MOVE_3_TARGET_NA = 11;
  ACTION_ENUM__MOVE_3_TARGET_1 = 12;
  ACTION_ENUM__MOVE_3_TARGET_2 = 13;
  ACTION_ENUM__MOVE_3_TARGET_3 = 14;
  ACTION_ENUM__MOVE_3_TARGET_4 = 15;
  ACTION_ENUM__MOVE_4_TARGET_NA = 16;
  ACTION_ENUM__MOVE_4_TARGET_1 = 17;
  ACTION_ENUM__MOVE_4_TARGET_2 = 18;
  ACTION_ENUM__MOVE_4_TARGET_3 = 19;
  ACTION_ENUM__MOVE_4_TARGET_4 = 20;
  ACTION_ENUM__SWITCH_1 = 21;
  ACTION_ENUM__SWITCH_2 = 22;
  ACTION_ENUM__SWITCH_3 = 23;
  ACTION_ENUM__SWITCH_4 = 24;
  ACTION_ENUM__SWITCH_5 = 25;
  ACTION_ENUM__SWITCH_6 = 26;
  ACTION_ENUM__DEFAULT = 27;
  ACTION_ENUM__PASS = 28;
}

enum WildCardEnum {
  WILD_CARD_ENUM___UNSPECIFIED = 0; 
  WILD_CARD_ENUM__CAN_NORMAL = 1; 
  WILD_CARD_ENUM__CAN_MEGA = 2; 
  WILD_CARD_ENUM__CAN_ZMOVE = 3; 
  WILD_CARD_ENUM__CAN_MAX = 4; 
  WILD_CARD_ENUM__CAN_TERA = 5; 
}

message Action {
  ActionEnum action = 1;
  WildCardEnum wildcard = 2;
}

message StepRequest {
  string username = 1;
  repeated Action actions = 2;
  int32 rqid = 3;
  bool teampreview = 4;
}

message ResetRequest {
  string username = 1;
  repeated int32 species_indices = 2;
  repeated int32 packed_set_indices = 3;
  string smogon_format = 4;
  int32 current_ckpt = 5;
  int32 opponent_ckpt = 6;
}

message EnvironmentState {
  bytes info = 1;
  bytes action_mask = 2;
  bytes wildcard_mask = 3;
  bytes history_entity_public = 4;
  bytes history_entity_revealed = 5;
  bytes history_entity_edges = 6;
  bytes history_field = 7;
  int32 history_length = 8;
  bytes moveset = 9;
  bytes public_team = 10;
  bytes revealed_team = 11;
  bytes private_team = 12;
  bytes field = 13;
  int32 rqid = 14;
}

message EnvironmentTrajectory {
  repeated EnvironmentState states = 1;
}

message EnvironmentResponse {
  string username = 1;
  EnvironmentState state = 2;
}

message ErrorResponse {
  string trace = 1;
}

message WorkerRequest {
  int32 task_id = 1;
  oneof request {
    StepRequest step_request = 2;
    ResetRequest reset_request = 3;
  }
}

message WorkerResponse {
  int32 task_id = 1;
  EnvironmentResponse environment_response = 2; 
  ErrorResponse error_response = 3; 
  optional ResetRequest opponent_reset_request = 4;
}
